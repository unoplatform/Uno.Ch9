jobs:
- job: Release_AppCenter
  pool: $(windowsPoolName)

  container: nventive/build-agent:vs16.6.0

  steps:
  - checkout: none

  - task: DownloadBuildArtifacts@0
    inputs:
      buildType: current
      downloadType: single
      artifactName: Release_Android

  - task: AndroidSigning@3
    displayName: 'Signing and aligning APK file(s) $(System.ArtifactsDirectory)/Release_Android/*.apk'
    inputs:
      apkFiles: '$(System.ArtifactsDirectory)/Release_Android/*.apk'
      apksignerKeystoreFile: ch9.jks
      apksignerKeystorePassword: '$(AndroidSigningStorePass)'
      apksignerKeystoreAlias: '$(AndroidSigningKeyAlias)'
      apksignerKeyPassword: '$(AndroidSigningKeyPass)'

  - task: AppCenterDistribute@3
    displayName: 'Deploy Android to Visual Studio App Center'
    inputs:
      serverEndpoint: 'Uno AppCenter'
      appSlug: 'uno-platform/Ch9-1'
      appFile: '$(System.ArtifactsDirectory)/Release_Android/uno.platform.ch9-Signed.apk'
      symbolsOption: Android
      releaseNotesInput: 'CI build'
      isSilent: true

  - task: DownloadBuildArtifacts@0
    inputs:
      buildType: current
      downloadType: single
      artifactName: Release_iOS

  - task: AppCenterDistribute@3
    displayName: 'Deploy iOS to Visual Studio App Center'
    inputs:
      serverEndpoint: 'Uno AppCenter'
      appSlug: 'uno-platform/Ch9'
      appFile: '$(System.ArtifactsDirectory)/Release_iOS/Ch9.ipa'
      symbolsDsymFiles: '$(System.ArtifactsDirectory)/Release_iOS/Ch9.dSYM'
      symbolsIncludeParentDirectory: false
      releaseNotesInput: 'CI build'
      isSilent: true