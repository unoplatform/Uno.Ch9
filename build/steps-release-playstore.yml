jobs:
- job: Release_PlayStore
  pool: $(windowsPoolName)

  container: nventive/build-agent:vs16.6.0

  steps:
  - checkout: none

  - task: DownloadBuildArtifacts@0
    inputs:
      buildType: current
      downloadType: single
      artifactName: Release_Android

  - task: DownloadSecureFile@1
    name: keyStore
    displayName: "Download keystore from secure files"
    inputs:
      secureFile: ch9.jks

  - task: Bash@3
    displayName: "Build and sign App Bundle"
    inputs:
      targetType: "inline"
      script: |
        jarsigner.exe -keystore $(keyStore.secureFilePath) -storepass $(AndroidSigningStorePass) -keypass $(AndroidSigningKeyPass) -digestalg SHA-256 -sigalg SHA256withRSA $(System.ArtifactsDirectory)/Release_Android/uno.platform.ch9.aab $(AndroidSigningKeyAlias)

  - task: ms-vsclient.google-play.google-play-release.GooglePlayRelease@3
    displayName: 'Release ARM64 and ARM7 to internal'
    inputs:
      serviceConnection: Ch9
      apkFile: '$(System.ArtifactsDirectory)/Release_Android/uno.platform.ch9.aab'
      languageCode: 'en-CA'
      # additionalApks: '$(System.ArtifactsDirectory)/Release_Android/uno.platform.ch9.apk'